"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[914],{4914:function(e,t,n){n.r(t),n.d(t,{default:function(){return Pe}});var i=n(885),r=n(1413),s=n(5987),o=n(2791),a=n(6871),l=n(5973),c=n(229),d=n(3540),u=n(7314),h=n(1745),x=n(472),v=n(5152),f=n(5209),p=n(6015),m=n(803),j=n(5953),Z=n(4565),g=n(1872),b=n(4142),y=n(604),w=n(5461),D=n(1478),S=n(501),C=n(4281),k=n(4058),P=n(4853),I=n(9161),T=n(2089),z=n(4942),Y=n(2797),O=n(7205),L=n(5399),M=n(7248),N=n(5450),_=n(6283),B=n(1680),A=n(9827),F=n(807),E=n(4390),U=n(9773),R=n(1803),W=n(1898),H=n(3057),V=n(324),q=n(4162),Q=n(3978),K=n(230),X=n(8821),G=n(1566),J=n(1009),$=n(5108),ee=n(7438),te=n(8914),ne=n(7892),ie=n.n(ne),re=n(277),se=n(3634),oe=n(1652),ae=n(4639),le=n(6767),ce=n(822),de=n(8928),ue=n(3767),he=n(184),xe=["versionDates","day"],ve=(0,re.ZP)(ae.H)((function(e){return{"&:after, :hover::after":{content:'"."',fontSize:"1.5rem",bottom:"-0.5rem",position:"absolute",color:e.theme.palette.primary.main,opacity:.5},"&:hover::after":{opacity:1}}}));function fe(e){var t=e.versionDates,n=void 0===t?[]:t,i=e.day,o=(0,s.Z)(e,xe);return n.indexOf(ie()(i).format("YYYY-MM-DD"))>=0?(0,he.jsx)(ve,(0,r.Z)((0,r.Z)({},o),{},{day:i})):(0,he.jsx)(ae.H,(0,r.Z)((0,r.Z)({},o),{},{day:i}))}function pe(e){var t=e.smallScreen,n=e.onChange,i=e.versions.filter((function(e){return 10===e.version.length})).map((function(e){return e.version}));return(0,he.jsx)(ue.Z,{onClickAway:function(){return n("close")},children:(0,he.jsx)(de.Z,{sx:!t&&{position:"absolute",right:0,zIndex:999},raised:!0,children:(0,he.jsx)(oe._,{dateAdapter:se.y,children:(0,he.jsx)(le.W,{loading:!i,format:"YYYY-MM-DD",renderLoading:function(){return(0,he.jsx)(ce.e,{})},slots:{day:fe},onChange:function(e,t){return"finish"===t?n(ie()(e).format("YYYY-MM-DD")):null},slotProps:{day:{versionDates:i}},shouldDisableDate:function(e){return t=e,!(i.indexOf(ie()(t).format("YYYY-MM-DD"))>=0);var t},disableHighlightToday:!0,minDate:ie()(i.slice(-1)[0]),maxDate:ie()(i[0])})})})})}function me(e){var t=e.project,n=(0,o.useContext)(K.N),r=(0,o.useState)(),s=(0,i.Z)(r,2),a=s[0],l=s[1];(0,o.useEffect)((function(){t&&n&&l(n[null===t||void 0===t?void 0:t.id])}),[t,n]);var c=(0,b.Z)(),d=(0,Y.Z)(c.breakpoints.down("sm")),u=(0,o.useState)(!1),h=(0,i.Z)(u,2),x=h[0],v=h[1],p=function(){return v(!1)};return(0,he.jsxs)(he.Fragment,{children:[(0,he.jsxs)(O.Z,{onClick:function(){v(!0),ee.y(ee.z.rawDatasetButtonClicked,{project_id:t.id})},variant:"contained",children:[(0,he.jsx)(G.Z,{sx:{fontSize:"1rem"}}),"\xa0Raw Dataset"]}),(0,he.jsxs)(L.Z,{open:x,onClose:p,maxWidth:"lg",fullWidth:!0,fullScreen:d,keepMounted:!0,children:[d&&(0,he.jsx)(M.Z,{sx:{justifyContent:"start"},children:(0,he.jsxs)(O.Z,{autoFocus:!0,onClick:p,children:[(0,he.jsx)(J.Z,{sx:{fontSize:"1rem"}}),"Back"]})}),(0,he.jsxs)(N.Z,{sx:{px:d?2:3,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"start",height:"100%"},children:[(0,he.jsx)(f.Z,{label:t.title,size:"small",sx:{mb:1}}),(0,he.jsx)(Z.Z,{variant:"h6",children:"Preview and download raw dataset(s)"}),(0,he.jsx)(je,{datasets:a,smallScreen:d,project:t}),a&&(0,he.jsxs)(Z.Z,{variant:"caption",sx:{my:3,fontStyle:"italic"},children:["This dataset is provided by the CITIES Dashboard with the support of ",t.owner,". Should you intend to utilize this dataset for your project, research, or publication, we kindly request that you notify us at ",(0,he.jsx)(_.Z,{href:"mailto:nyuad.cities@nyu.edu",children:"nyuad.cities@nyu.edu"})," to discuss citation requirements."]})]})]})]})}var je=function(e){var t=e.datasets,n=e.smallScreen,s=e.project,a=(0,o.useState)(),l=(0,i.Z)(a,2),c=l[0],d=l[1],u=(0,o.useState)(),h=(0,i.Z)(u,2),x=h[0],v=h[1];return(0,o.useEffect)((function(){var e,n,i,s;(null===t||void 0===t?void 0:t.length)>0&&(d(null===(e=t[0])||void 0===e?void 0:e.versions[0]),v(null===(n=t[0])||void 0===n?void 0:n.id),(0,te.m)(null===(i=t[0])||void 0===i||null===(s=i.versions[0])||void 0===s?void 0:s.rawLink,"csv").then((function(e){var n;d((0,r.Z)((0,r.Z)({},null===(n=t[0])||void 0===n?void 0:n.versions[0]),{},{fetchedDataset:e}))})))}),[t]),(0,he.jsxs)(j.ZP,{container:!0,justifyContent:"center",alignItems:"start",spacing:3,children:[(0,he.jsx)(j.ZP,{item:!0,sm:12,md:6,children:(0,he.jsx)(Ze,{datasets:t,smallScreen:n,previewingDataset:c,setPreviewingDataset:d,previewingDatasetId:x,setPreviewingDatasetId:v})}),(0,he.jsx)(j.ZP,{item:!0,sm:12,md:6,maxWidth:n?"100%":"unset",sx:{mt:1},children:(0,he.jsx)(be,{previewingDataset:c,previewingDatasetId:x,project:s,smallScreen:n})})]})},Ze=function(e){var t=e.datasets,n=e.smallScreen,i=e.previewingDataset,r=e.setPreviewingDataset,s=e.previewingDatasetId,o=e.setPreviewingDatasetId;return(0,he.jsxs)(B.Z,{size:"small",sx:{tableLayout:"fixed","& td, div, .MuiMenuItem-root":{fontSize:n?"0.625rem":"0.8rem"}},children:[(0,he.jsx)(A.Z,{children:(0,he.jsxs)(F.Z,{children:[(0,he.jsx)(E.Z,{sx:{pl:1},children:"Dataset"}),(0,he.jsx)(E.Z,{sx:{width:n?"9.5rem":"11rem"},children:"Version"}),(0,he.jsx)(E.Z,{sx:{width:n?"5rem":"6rem"},children:"Size"})]})}),(0,he.jsx)(U.Z,{children:null===t||void 0===t?void 0:t.map((function(e){return(0,he.jsx)(ge,{smallScreen:n,dataset:e,previewingDataset:i,setPreviewingDataset:r,isPreviewing:e.id===s,setPreviewingDatasetId:o},e.id)}))})]})},ge=function(e){var t=e.smallScreen,n=e.dataset,s=e.setPreviewingDataset,a=e.isPreviewing,l=e.previewingDatasetId,c=e.setPreviewingDatasetId,d=(0,o.useState)({}),u=(0,i.Z)(d,2),h=u[0],x=u[1],f=(null===n||void 0===n?void 0:n.versions[0])||{},p=(0,o.useState)(!1),m=(0,i.Z)(p,2),j=m[0],Z=m[1],g=(0,o.useState)(f),y=(0,i.Z)(g,2),w=y[0],D=y[1],S=null===n||void 0===n?void 0:n.versions.slice(0,3);S.find((function(e){return e==w}))||S.push((0,r.Z)((0,r.Z)({},w),{},{isOlderVersion:!0}));var C=(null===n||void 0===n?void 0:n.versions.length)>3,P=function(e){var t=e.target.value;if("Calendar"!==t){var i=null===n||void 0===n?void 0:n.versions.find((function(e){return e.version===t}));D(i),c(n.id),s(i),T(i)}else Z(!0)},I=function(e){Z(!1),"close"!==e&&P({target:{value:e}})},T=function(e){h[e.version]?s(h[e.version]):(0,te.m)(e.rawLink,"csv").then((function(t){var n=(0,r.Z)((0,r.Z)({},e),{},{fetchedDataset:t});s(n),x((0,r.Z)((0,r.Z)({},h),{},(0,z.Z)({},n.version,n)))}))},Y=function(){l!==n.id&&(c(n.id),s(w),T(w))},O=(0,b.Z)();return(0,he.jsx)(he.Fragment,{children:(0,he.jsxs)(F.Z,{children:[(0,he.jsx)(E.Z,{sx:{pl:1,cursor:"pointer",background:a&&O.palette.background.NYUpurpleLight},onClick:Y,children:null===w||void 0===w?void 0:w.name}),(0,he.jsxs)(E.Z,{sx:{position:"relative",background:a&&O.palette.background.NYUpurpleLight},children:[j&&(t?(0,he.jsx)(R.Z,{open:j,sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,he.jsx)(pe,{onChange:I,smallScreen:t,versions:null===n||void 0===n?void 0:n.versions})}):(0,he.jsx)(pe,{onChange:I,versions:null===n||void 0===n?void 0:n.versions})),(0,he.jsx)(W.Z,{size:"small",children:(0,he.jsxs)(H.Z,{value:null===w||void 0===w?void 0:w.version,onClick:function(){n.versions.length<=1&&Y()},onChange:P,variant:"standard",MenuProps:{disablePortal:!0},children:[S.map((function(e,t){return(0,he.jsx)(V.Z,{value:e.version,sx:[t===S.length-1&&{mb:-.75},e.isOlderVersion&&{marginTop:"1rem","&::before":{content:'""',borderTop:"2px dotted ".concat(O.palette.text.secondary),width:"1rem",height:"1rem",position:"absolute",top:0,left:"50%",transform:"translate(-50%, -50%)"}}],children:(0,he.jsxs)(q.Z,{direction:"row",alignItems:"center",children:[e.version,e===f&&(0,he.jsx)(v.Z,{title:"Latest version",enterDelay:0,leaveDelay:200,children:(0,he.jsx)(Q.Z,{sx:{ml:.5,width:"1rem",height:"1rem",background:O.palette.success.main},children:(0,he.jsx)(k.Z,{sx:{width:"0.8rem",height:"0.8rem"}})})})]})},e.version)})),C&&(0,he.jsx)(V.Z,{value:"Calendar",sx:{pt:1,mt:1,mb:-.75,borderTop:"0.5px solid"},children:(0,he.jsxs)(q.Z,{direction:"row",alignItems:"center",children:["Older Versions",(0,he.jsx)($.Z,{fontSize:"small",sx:{ml:.5}})]})},"Calendar")]})})]}),(0,he.jsx)(E.Z,{sx:{background:a&&O.palette.background.NYUpurpleLight},children:function(e){if(e)return e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"}(null===w||void 0===w?void 0:w.sizeInBytes)})]},n.id)})},be=function(e){var t=e.previewingDataset,n=e.previewingDatasetId,r=e.project,s=e.smallScreen,a="[".concat(r.id,"] ").concat(null===t||void 0===t?void 0:t.name,"-").concat(null===t||void 0===t?void 0:t.version,".csv"),l=(0,b.Z)(),c=(0,o.useState)(""),d=(0,i.Z)(c,2),u=d[0],h=d[1],x=(0,o.useState)(""),v=(0,i.Z)(x,2),f=v[0],m=v[1];return(0,o.useEffect)((function(){if(null!==t&&void 0!==t&&t.fetchedDataset){var e=null===t||void 0===t?void 0:t.fetchedDataset,n=e.split("\n"),i=n.length;if(i<=10)h(e),m(Array.from({length:i},(function(e,t){return t+1})).join("\n"));else{var r=n.slice(0,5),s=n.slice(i-5),o=i-10,a=["... [".concat(o," rows hidden] ...")];h(r.concat(a).concat(s).join("\n")),m(Array.from({length:11},(function(e,t){var n=t+1;return n<6?n:6==n?"":o+n-1})).join("\n"))}}}),[t]),(0,he.jsxs)(q.Z,{spacing:1,children:[(0,he.jsxs)(p.Z,{sx:{"& *":{fontFamily:"monospace !important"}},children:[(0,he.jsx)(q.Z,{direction:"row",children:(0,he.jsx)(Z.Z,{variant:"body2",gutterBottom:!0,fontWeight:600,children:t?"Previewing: ".concat(t.name," (").concat(null===t||void 0===t?void 0:t.version,")"):"Not previewing any dataset"})}),(0,he.jsx)(p.Z,{component:"pre",sx:{overflowX:"auto",color:l.palette.text.secondary,backgroundColor:l.palette.customBackground,p:2,pt:1.5,borderRadius:l.spacing(1),borderTopLeftRadius:0,minHeight:"5rem",width:s?"100%":"unset",marginTop:0},children:(0,he.jsxs)(q.Z,{direction:"row",sx:{fontSize:s?"0.625rem !important":"0.8rem !important"},children:[(0,he.jsx)(p.Z,{sx:{mr:2,userSelect:"none"},children:f}),(0,he.jsx)(p.Z,{children:u})]})})]}),(0,he.jsx)(p.Z,{textAlign:"center",children:(0,he.jsxs)(O.Z,{variant:"contained",sx:{textTransform:"none",textAlign:"left",lineHeight:1.1,px:1.5,py:1},onClick:function(){!function(){if(null!==t&&void 0!==t&&t.fetchedDataset){var e=new Blob([null===t||void 0===t?void 0:t.fetchedDataset],{type:"application/octet-stream"}),n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=a,document.body.appendChild(i),i.click(),URL.revokeObjectURL(n),document.body.removeChild(i)}}(),ee.y(ee.z.rawDatasetDownloaded,{project_id:r.id,dataset_id:n,dataset_name:t.name,dataset_version:t.version})},disabled:!t,children:[(0,he.jsx)(X.Z,{sx:{fontSize:"1.25rem",mr:.5}}),t?a:"No dataset available to download"]})})]})},ye=n(1131),we=n(6344),De=n(445);var Se=function(e){var t=e.text,n=e.wordLimit,r=void 0===n?60:n,s=e.reference,a=(0,o.useState)(!1),l=(0,i.Z)(a,2),c=l[0],u=l[1],h=(0,b.Z)(),x=(0,Y.Z)(h.breakpoints.down("sm")),v=(0,o.useRef)(null),f=t.split(" ");if(!x||f.length/r<=1.4)return(0,he.jsxs)(p.Z,{children:[(0,he.jsx)(Z.Z,{children:(0,d.ZP)(t,{replace:T.T})}),s&&(0,he.jsx)(Z.Z,{variant:"caption",color:"text.secondary",children:(0,d.ZP)(s,{replace:T.T})})]});var m=f.slice(0,r).join(" "),j=m.lastIndexOf(".");return-1!==j&&(m=m.slice(0,j+1)),(0,he.jsx)(ue.Z,{onClickAway:function(e){(function(e){for(var t=e.target,n=v.current.closest(".MuiContainer-root"),i=new Set(["rect","path","svg","circle"]);null!=t;){if(i.has(t.tagName))return t.closest(".MuiContainer-root")===n;t=t.parentNode}return!1})(e)||u(!1)},children:(0,he.jsx)(p.Z,{ref:v,onClick:function(){return u(!c)},style:{cursor:"pointer"},children:c?(0,he.jsxs)(he.Fragment,{children:[(0,he.jsx)(Z.Z,{children:(0,d.ZP)(t,{replace:T.T})}),s&&(0,he.jsx)(Z.Z,{variant:"caption",color:"text.secondary",children:(0,d.ZP)(s,{replace:T.T})})]}):(0,he.jsxs)(he.Fragment,{children:[(0,he.jsxs)(Z.Z,{display:"inline",children:[(0,d.ZP)(m,{replace:T.T}),"..."]}),(0,he.jsx)(Z.Z,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})},Ce=["tooltipTitle"],ke=function(e){var t=e.tooltipTitle,n=(0,s.Z)(e,Ce);return(0,he.jsx)(v.Z,{title:t,enterDelay:0,leaveDelay:200,children:(0,he.jsx)(f.Z,(0,r.Z)({size:"small"},n))})},Pe=function(e){var t=e.themePreference,n=(0,o.useContext)(l.F),s=(0,i.Z)(n,4),v=(s[0],s[1]),f=s[2],z=s[3],Y=(0,a.UO)().id,O=(0,o.useState)({}),L=(0,i.Z)(O,2),M=L[0],N=L[1],_=(0,o.useState)(!1),B=(0,i.Z)(_,2),A=B[0],F=B[1],E=(0,o.useContext)(c.q),U=(0,i.Z)(E,2),R=U[0],W=U[1],H=(0,a.s0)(),V=(0,o.useContext)(De.c),q=(0,i.Z)(V,1)[0][M.id],Q=(0,o.useContext)(K.N),X=(0,o.useState)(null),G=(0,i.Z)(X,2),J=G[0],$=G[1],te=(0,b.Z)();return(0,o.useEffect)((function(){var e=w.find((function(e){return e.id===Y})),t=[];if(e){N((0,r.Z)({},e));for(var n={},i=0;i<e.charts.length;i++)n[i]=0;W(n),F(!0),t=e.charts.map((function(e,t){return{chartTitle:e.title,chartID:"chart-".concat(t+1)}}))}else v("404"),H("/404",{replace:!0});v("project"),z(t)}),[Y,v,z]),(0,o.useEffect)((function(){M.title&&(document.title="".concat(M.title," | CITIES Dashboard"))})),(0,o.useEffect)((function(){if(Q){var e=Q[M.id];if(e){var t=e.flatMap((function(e){return e.versions?e.versions[0].version:[]})),n=t.length>0?t.reduce((function(e,t){return e>t?e:t})):null;$(n)}}}),[Q,M.id]),(0,he.jsx)(he.Fragment,{children:A&&(0,he.jsxs)(p.Z,{width:"100%",children:[(0,he.jsx)(we.Z,{backgroundColor:"customAlternateBackground",children:(0,he.jsxs)(m.Z,{sx:{pt:5,pb:3},children:[(0,he.jsx)(h.Z,{text:M.title}),(0,he.jsxs)(j.ZP,{container:!0,spacing:1,sx:{pb:3,mt:-3},children:[(0,he.jsx)(j.ZP,{item:!0,children:(0,he.jsx)(ke,{icon:(0,he.jsx)(S.Z,{}),label:M.owner,tooltipTitle:"Dataset Owner"})}),(0,he.jsx)(j.ZP,{item:!0,children:(0,he.jsx)(ke,{icon:(0,he.jsx)(C.Z,{}),label:M.contact,tooltipTitle:"Contact",component:"a",href:"mailto:".concat(M.contact),clickable:!0})}),(0,he.jsx)(j.ZP,{item:!0,children:(0,he.jsx)(ke,{icon:(0,he.jsx)(P.Z,{}),label:"".concat(M.charts.length," Chart").concat(M.charts.length>1&&"s"),tooltipTitle:"Number of Charts",onClick:function(){(0,ye.Qj)(D.O3.id),ee.y(ee.z.internalNavigation,{destination_id:D.O3.id,destination_label:D.project.toString(),origin_id:"chip"})}})}),J&&(0,he.jsx)(j.ZP,{item:!0,children:(0,he.jsx)(ke,{icon:(0,he.jsx)(k.Z,{}),label:"Last update: ".concat(J),tooltipTitle:"Last Update"})}),null!=q&&(0,he.jsx)(j.ZP,{item:!0,children:(0,he.jsx)(ke,{icon:(0,he.jsx)(I.Z,{}),label:"".concat(q," Comment").concat(q>1?"s":""),tooltipTitle:"Number of Comments",onClick:function(){(0,ye.Qj)(D.Sf.id),ee.y(ee.z.internalNavigation,{destination_id:D.Sf.id,destination_label:D.Sf.toString(),origin_id:"chip"})}})})]}),(0,he.jsx)(Z.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{textAlign:"justify",pb:3,mb:0,"& table *":{color:"".concat(te.palette.text.secondary)}},gutterBottom:!0,children:M.description?(0,d.ZP)(M.description,{replace:T.T}):"No project description"}),(0,he.jsx)(me,{project:M})]})}),(0,he.jsx)(p.Z,{id:D.O3.id,children:M.charts.map((function(e,n){return(0,he.jsx)(we.Z,{id:f[n].chartID,backgroundColor:n%2!=0&&"customAlternateBackground",children:(0,he.jsxs)(m.Z,{sx:{pt:4,pb:4},height:"auto",className:t===y.Z.dark?"dark":"",children:[(0,he.jsxs)(Z.Z,{variant:"h6",color:"text.primary",children:[n+1,". ",e.title]}),(0,he.jsx)(u.Z,{chartData:(0,r.Z)({chartIndex:n,sheetId:M.sheetId},e)}),(0,he.jsx)(p.Z,{sx:{my:3},children:(0,he.jsxs)(Z.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:[e.subtitle&&(0,he.jsx)(Se,{text:e.subtitle,reference:e.reference?e.reference:void 0}),Object.keys(R)[n]==n&&e.subcharts&&e.subcharts[Object.values(R)[n]].subchartSubtitle&&(0,he.jsx)(Se,{text:e.subcharts[Object.values(R)[n]].subchartSubtitle,reference:e.subcharts[Object.values(R)[n]].reference?e.subcharts[Object.values(R)[n]].reference:void 0})]})})]})},n)}))}),(0,he.jsx)(g.Z,{}),(0,he.jsx)(we.Z,{id:D.Sf.id,sx:{pt:3,pb:4},children:(0,he.jsx)(x.Z,{pageID:M.id})})]})})}}}]);
//# sourceMappingURL=914.efc36e63.chunk.js.map